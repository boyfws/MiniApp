# База данных PostgreSQL 

## Используемые расширения 
- pg_trim для удобного и быстрого поиска наиболее похожего названия ресторана 
- postgis для работы с географическими данными  
## Принцип работы (key moments for backend)
1) Все id кроме пользоавательского генерируются автоматически с помощью SMALLSERIAL, SERIAL и BIGSERIAL - указывать их при вставке не нужно
2) Номера телефонов в таблице restaurants хранятся в виде строки из 11 символов и начинаются с 7, введена проверка на это условие для стнадартизации формата хранения 
3) При вставке/изменении в restaurants не нужно вность location, он автоматически распакуется и добавится из GEOJson из address. 
Также будет проведена проверка формата переданного GEOJson. Это позволит улучшить согласованность данных и защитит от 
возможных ошибок в будущем 
5) Кол-во фото для одного ресторана, которые будут показаны на странице от 3 до 8 включительно
## Пользоавтели 

### reader 
Имеет право только на чтение внутри базы данных, не имееет права на изменение данных и структуры базы данных. 
Роль предназначена для аналитиков и других пользователей БД, от действий которых нужно защитить базу данных 

### backend
Роль предназначена для взаимодействия backend с базой данных. Дает доступ к чтению практически всех таблиц
и к изменению содержания всех необходимых для backend таблиц.


**NOTE: Использоавние ролей позволяет защитить базу данных от ошибок при разработке других частей продукта и от 
нежелательного воздействия. Ни одна из ролей не имеет права создавать новые схемы, менять структуру схемы public, а 
также доступ к изменению таблиц categories и log_actions определяющих систему ограничен для всех ролей**

## Триггеры
1) Триггер на добавление категории в массив вторичных ключей categories в restaurants 
2) Триггер на удаление категории, для поиска ссылок на нее в restaurants в столбце categories
3) Триггер на обновление категории, для поиска ссылок на нее в restaurants в столбце categories
4) Триггер на добавление location при вставке/обновлении в restaurants

