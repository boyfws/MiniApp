# Фронт
## Общие сведения 
- Для стейт менеджмента использованы _React Context_ и _Zustand_. Context используется в общем случае где нет риска перерендера, а Zustand как основной стейт менеджер 
- Функциональная и визуальная интеграция с TG реализована через _@telegram-apps/telegram-ui_
- Структура компонентов выстраивается через ATOM - Atomic Design с небольшими дополнениям (например иконки не выносятся в отд. атомы для удобства)

![](../photos/atomic.png)

- Размеры элементов централизованно управляются через styles.css для реализации возможности более тонкой адаптации под мобильные экраны
- Сайт защищен от индексации, так как будет доступен только как мини приложение в TG 
- Кэширование локальных стейтов связанных с MainPage реализовано через _react-router-cache-route_ (например чтобы сохранить выбранные пользователем категории при переходе на страницу ресторана и обратно, без необходимости ручного создания global state через state manager) 

## Принцип работы 

### Структура проекта

Каждая директория с компонентом в общем случае содержит в себе .js файл с компонентом, .css файл с со стилями и директорию utils с хэндлерами и вебхуками связанными с компонентом, для реализации Single Responsibility Principle и инкапсулирования логики работы внутри компонента

#### Public

Данная директория содержит .css файл с общими стилями для проекта, .html файл и robots.txt для сокрытия сайта от индексирования 

#### Src

1) _api_

   Данная директория содержит в себе функции для работы с API бэкэнда, все функции опираются на функции из поддиректории _queries_, которые инкапсулируют обновление access токенов и retry при неудачных запросах
2) _components_

    Данная директория содержит компоненты разделенные на __icons_, _atoms_, _molecules_, _organisms_, _templates_. Атомы - самые маленькие компоненты, не имеющие зависимых компонентов, молекулы собираются из атомов, организмы из молекул и так далее
3) _pages_

    Директория содержит в себе поддиректории для каждой из страниц 
4) _state_management_

    Данная директория включает в себя _context_, _stores_, и _utils_. Context содержит в себе конексты и файл объединяющий их Provider-ы в один общий для проекта context provider. Store хранит несколько Zustand хранилищ

5) _App.js_ и _index.js_ 

    Собирают React приложение 

6) _telegramInit.js_

    Данный скрипт используется для верификации пользователя открывшего мини приложения 

### Описание функциональности 

При открытии любой страницы мини-приложения, в первую очередь асинхронно запускается telegramInit, который контролирует глобальное bool состояние, уведомляющее другие компоненты о том, что данные верифицированы. В случае успешной верификации, в sessionStorage будут помещены access и refresh токены и id пользователя 

#### При открытии MainPage:
Для каждого набора данных, который должен быть загружен, присутствует флаг в контексте, уведомляющий о том, что эти данные загружены. Данные флаги используются единожды при первой загрузке, что исключает возможность случайных повторных ренедров. Последний адрес достается из Telegram CloudStorage - удаленного хранилища, предоставляемого API Tg для мини-приложений. Это ограничивает кол-во телеграмм клиентов, где может быть использовано наше мини приложение, так как это недавнее обновление. Пока все флаги о том, что все необходимые данные загружены не будут подняты пользователю будет показан экран загрузки 

#### При открытии ProfilePage
Coming soon...

#### При открытии RestaurantPage
Coming soon...

#### Дальнейший потребительский путь на MainPage 
Пользователю будут показаны рестораны рядом с его последним адресом, так же он может переключиться на другой адрес, или добавить новый. При добавлении нового ресторана ему будут показаны подсказки. Также он может воспользоваться кнопкой для определения своего адреса, после чего ему будет преложено выбрать один из наиболее подходящих ему адресов, которые будут определены по координатам. Также у пользователя будет возможность искать рестораны по названию 



### Структура импортов 
1) Css
2) External lib.
3) State
4) Handlers
5) Webhook
6) Components
7) Icon
8) Utils